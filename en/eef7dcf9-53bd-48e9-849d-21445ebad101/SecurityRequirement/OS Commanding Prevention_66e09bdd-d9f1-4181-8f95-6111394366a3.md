{
  "id": "95",
  "name": "OS Commanding Prevention",
  "description": "<p>Command injection (or OS Command Injection) is a type of injection where software that constructs a system command using externally influenced input does not correctly neutralize the input from special elements that can modify the initially intended command.<br /></p><p>The problem is exacerbated if the compromised process does not follow the principle of least privileges and attacker-controlled commands end up running with special system privileges that increase the amount of damage.</p><p>Command injection is an attack in which the goal is execution of arbitrary commands on the host operating system via a vulnerable application. Command injection attacks are possible when an application passes unsafe user supplied data (forms, cookies, HTTP headers etc.) to a system shell. In this attack, the attacker-supplied operating system commands are usually executed with the privileges of the vulnerable application. Command injection attacks are possible largely due to insufficient input validation.</p><p>This attack differs from Code Injection, in that code injection allows the attacker to add their own code that is then executed by the application. In Command Injection, the attacker extends the default functionality of the application, which execute system commands, without the necessity of injecting code.</p><p>Ensure all input is validated, and does not contain file system commands</p><p>1: Avoid calling OS commands directly</p><p>The primary defense is to avoid calling OS commands directly. Built-in library functions are a very good alternative to OS Commands, as they cannot be manipulated to perform tasks other than those it is intended to do.</p><p>For example use mkdir() instead of system(&quot;mkdir /dir_name&quot;).</p><p>If there are available libraries or APIs for the language you use, this is the preferred method.</p><p>2: Escape values added to OS commands specific to each OS</p><p>TODO: To enhance.</p><p>For examples, see escapeshellarg() or escapeshellcmd() in PHP.</p><p>3: Parameterization in conjunction with Input Validation</p><p>If calling a system command that incorporates user-supplied cannot be avoided, the following two layers of defense should be used within software to prevent attacks:</p><p>Layer 1</p><p>Parameterization: If available, use structured mechanisms that automatically enforce the separation between data and command. These mechanisms can help provide the relevant quoting and encoding.</p><p>Layer 2</p><p>Input validation: The values for commands and the relevant arguments should be both validated. There are different degrees of validation for the actual command and its arguments:</p><p>• When it comes to the commands used, these must be validated against a whitelist of allowed commands.</p><p>• In regards to the arguments used for these commands, they should be validated using the following options:</p><p>• Positive or whitelist input validation: Where are the arguments allowed explicitly defined.</p><p>• White list Regular Expression: Where a whitelist of good, allowed characters and the maximum length of the string are defined. Ensure that metacharacters like ones specified in Note A and white-spaces are not part of the Regular Expression. For example, the following regular expression only allows lowercase letters and numbers and does not contain metacharacters. The length is also being limited to 3-10 characters: ^[a-z0-9]{3,10}$</p><p><br /></p><p><b>Reference:</b></p><p><a href=\"https://owasp.org/www-community/attacks/Command_Injection\" target=\"_blank\">https://owasp.org/www-community/attacks/Command_Injection</a></p><p><a href=\"https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html#description-of-command-injection-vulnerability\" target=\"_blank\">https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html#description-of-command-injection-vulnerability</a></p>",
  "labels": "ThreatModeler,AppSec and InfraSec,Web Application,Web Service,App,Native Application,Thick Client,TM-250",
  "libraryId": "1",
  "isHidden": false,
  "guid": "66e09bdd-d9f1-4181-8f95-6111394366a3",
  "riskId": 2,
  "isCompensatingControl": false,
  "riskName": "High",
  "isReadOnlyLibraryEntity": false,
  "lastUpdated": "2021-08-10T17:52:26.88",
  "libraryGuid": "eef7dcf9-53bd-48e9-849d-21445ebad101"
}